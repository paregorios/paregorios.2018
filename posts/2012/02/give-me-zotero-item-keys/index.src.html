<html><body><i>I fear and hope that this post will cause someone smarter than me to pipe up and say UR DOIN IT WRONG ITZ EZ LYK DIS ...</i><br><br><b>Here's the use case:</b><br><br>The <a href="http://idp.atlantides.org/">Integrating Digital Papyrology project</a> (and friends) have a <a href="http://www.zotero.org/groups/papyrology">Zotero group library</a> populated with 1,445 bibliographic records that were developed on the basis of an old, built-by-hand <a href="http://library.duke.edu/rubenstein/scriptorium/papyrus/texts/clist.html">Checklist of Editions of Greek and Latin Papyri (etc.)</a>. A lot of checking and improving was done to the data in Zotero.<br><br>Separately, there's now a much larger pile of bibliographic records related to papyrology that were collected (on different criteria) by the <a href="http://www.ulb.ac.be/philo/cpeg/bp.htm"><i>Bibliographie Papyrologique</i></a> project. They have been machine-converted (into <a href="http://www.tei-c.org/">TEI</a> document fragments) from a <i>sui generis</i> Filemaker Pro database and are now <a href="http://papyri.info/bibliosearch">hosted via papyri.info</a> (<a href="https://github.com/papyri/idp.data/tree/master/Biblio">the raw data is on github</a>).<br><br>There is considerable overlap between these two datasets, but also signifcant divergeance. We want to merge "matching" records in a carefully supervised way, making sure not to lose any of the extra goodness that BP adds to the data but taking full advantage of the corrections and improvements that were done to the Checklist data.<br><br>We started by doing an export-to-RDF of the Zotero data and, as a first step, that was banged up (programmatically) against the TEI data on the basis of titles. Probable matches were hand-checked and a resulting pairing of papyri.info bibliographic ID numbers against Zotero short titles was produced. You can see <a href="http://idp.atlantides.org/biblio-matching/matches-2012-02.xml">the resulting XML here</a>.<br><br><i>I should point out that almost everything up to here including the creation and improvement of the data, as well as anything below regarding the bibliography in papyri.info, is the work of others. Those others include Gabriel Bodard, Hugh Cayless, James Cowey, Carmen Lantz, Adam Prins, Josh Sosin, and Jen Thum. And the BP team. And probably others I'm forgetting at the moment or who have labored out of my sight. I erect this shambles of a lean-to on the shoulders of giants.</i><br><br>To guide the work of our bibliographic researchers in analyzing the matched records, I wanted to create an HTML file that looks like this:<br><blockquote class="tr_bq"><ul><li><b style="font-family: 'Courier New', Courier, monospace; font-size: small;">Checklist Short Title = Papyri.info ID number and Full Title String</b></li><li><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">BGU 10 = PI idno 7513: Papyrusurkunden aus ptolemäischer Zeit. (Ägyptische Urkunden aus den Staatlichen Museen zu Berlin. Griechische Urkunden. X. Band.)</span></li><li><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">etc.</span> </li></ul></blockquote>In that list, I wanted items to the left to be linked to the online view of the Zotero record at zotero.org and items on the right linked to the online view of the TEI record at papyri.info. The XML data we got from the initial match process provided the papyri.info bibliographic ID numbers, from which it's easy to construct the corresponding URIs, e.g., <a href="http://papyri.info/biblio/7513">http://papyri.info/biblio/7513</a>.<br><br>But Zotero presented a problem. URIs for bibliographic records in Zotero server use alphanumeric "item keys" like this: CJ3WSG3S (as in <a href="https://www.zotero.org/groups/papyrology/items/itemKey/CJ3WSG3S/">https://www.zotero.org/groups/papyrology/items/itemKey/CJ3WSG3S/</a>).<br><br><b>That item key string is not, to my knowledge, included in any of the export formats produced by the Zotero desktop client, nor is it surfaced in its interface (argh).</b> It appears possible to hunt them down programmatically via the <a href="http://www.zotero.org/support/dev/server_api/read_api">Zotero Read API</a>, though I haven't tried it for reasons that will be explained shortly. It is certainly possible to hunt for them manually via the web interface, but I'm not going to try that for more than about 3 records.<br><br><b>How I got the Zotero item keys</b><br><br>So, I have two choices at this point: write some code to automate hunting the item keys via the Zotero Read API or crack open the Zotero <a href="http://www.sqlite.org/">SQLLite</a> database on my local client and see if the item keys are lurking in there too. Since I'm on a newish laptop on which I hadn't yet installed <a href="http://itunes.apple.com/us/app/xcode/id448457090?mt=12">XCode</a>, which seems to be a prerequisite to installing support for a <a href="http://www.python.org/dev/peps/pep-0405/">Python virtual environment</a>, which is the preferred way to get <a href="http://www.pip-installer.org/en/latest/installing.html">pip</a>, which is the preferred install prerequisite for <a href="https://github.com/urschrei/pyzotero">pyzotero</a>, which is the python wrapper for the Zotero API, I had to make some choices about which yaks to shave.<br><br>I decided to start the (notoriously slow) XCode download yak and then have a go at the SQLLite yak while that was going on.<br><br>I grabbed the trial version of <a href="http://www.razorsql.com/">RazorSQL</a> (which looked like a good shortcut after a few minutes of Googling), made a copy of my Zotero database, and started poking around. I thought about looking for detailed documentation (<a href="http://www.zotero.org/support/zotero_data">starting here I guess</a>), but direct inspection started yielding results so I just kept going commando-style. It became clear at once that I wasn't going to find a single table containing my bibliographic entries. The Zotero client database is all normalized and modularized and stuff. So I viewed table columns and table contents as necessary and started building a SQL query to get at what I wanted. Here's what ultimately worked:<br><br><pre style="background-color: #eeeeee; border: 1px dashed #999999; color: black; font-family: Andale Mono, Lucida Console, Monaco, fixed, monospace; font-size: 12px; line-height: 14px; overflow: auto; padding: 5px; width: 100%;"><code>SELECT itemDataValues.value, items.key FROM items <br>INNER JOIN libraries ON items.libraryID = libraries.libraryID<br>INNER JOIN groups ON libraries.libraryID = groups.libraryID<br>INNER JOIN itemData ON items.itemID = itemData.itemID<br>INNER JOIN itemDataValues ON itemData.valueID = itemDataValues.valueID<br>INNER JOIN fields ON itemData.fieldID = fields.fieldID<br>WHERE groups.name= "Papyrology" AND fields.fieldID=116<br></code></pre><br>The SELECT statement gets me two values for each match dredged up by the rest of the query: a value stored in the itemDataValues table and a key stored in the items table. The various JOINs are used to get us close to the specific value (i.e., a short title) that we want. 116 in the fieldID field of the fields table corresponds to the short title field you see in your Zotero client. I found that out by inspecting the fields table; I could have used more JOINs to be able to use the string "shortTitle" in my WHERE clause, but that would have just taken more time.<br><br>The results of that query against my database looked like this:<br><br><pre style="background-color: #eeeeee; border: 1px dashed #999999; color: black; font-family: Andale Mono, Lucida Console, Monaco, fixed, monospace; font-size: 12px; line-height: 14px; overflow: auto; padding: 5px; width: 100%;"><code>P.Cair.Preis.    2245UKTH<br>CPR 18           26K8TAJT<br>P.Bodm. 28       282XKDE9<br>P.Gebelen        29ETKPXC<br>O.Krok           2BBMS7NS<br>P.Carlsb. 5      2D2ZNT4C<br>P.Mich.Aphrod.   2DTD2NIZ<br>P.Carlsb. 9      2FWF6T6I<br>P.Col. 1         2G4CF756<br>P.Lond.Copt. 2   2GAEU5QP<br>P.Harr. 1        2GCCNGJV<br>O.Deir el-Bahari 2GH3FEA2<br>P.Harrauer       2H3T6EU2<br>(etc).</code></pre><br>So, copy that tabular result out of the RazorSQL GUI, paste it into a new <a href="http://www.libreoffice.org/">LibreOffice</a> spreadsheet and save it and I've got <a href="http://idp.atlantides.org/biblio-matching/zdump-content.xml">an XML file</a> that I can dip into from <a href="http://idp.atlantides.org/biblio-matching/matches2html.xsl">the XSLT I had already started on</a> to produce my HTML view.<br><br><a href="http://idp.atlantides.org/biblio-matching/matches-2012-02.html">Here's the resulting HTML file</a>.<br><br>On we go.<br><br><i>Oh, and for those paying attention to such things, XCode finished downloading about two-thirds of the way through this process ...</i></body></html>